<app-dashboard></app-dashboard>

<div class="dashboard-main">
  <div class="container-fluid">
    <div class="table-responsive">
      <div class="table-wrapper">
        <div class="table-title">
          <div class="row " style="height: 60px;">
            <div class="col-sm-5 ">
              <h2 style="margin-bottom: 0;">Quản lý đơn đặt hàng</h2>
            </div>
            <div class="col-sm-7 text-end d-flex align-items-center justify-content-end">
              <a routerLink="/order_rq" class="btn btn-secondary btn-sm" data-toggle="modal" data-target=""
                style="font-size: 14px;">
                <i class="material-icons align-middle" style="font-size: 18px;">&#xE147;</i>
                <span class="align-middle">Thêm đơn hàng</span>
              </a>
            </div>
          </div>
          <table class="table table-striped table-hover">
          </table>
          <div class="row  justify-content-end">
            <div class="col-md-9 text-end">
              <div class="input-group mb-3">
                <!-- product.component.html -->
                <label>Từ: </label>
                <input style="margin-left: 10px;" type="date" class="form-control" placeholder="Đến: dd/mm/yyyy">

                <label>Đến: </label>
                <input style="margin-left: 10px;" type="date" class="form-control" placeholder="Đến: dd/mm/yyyy">

                <!-- product.component.html -->
                <select [(ngModel)]="selectedCategory" (change)="filterStatus()">
                  <option value="null" disabled selected>Tất cả đơn hàng</option>
                  <option *ngFor="let ps of userStatus" [value]="ps.status_id">{{ ps.status_name }}</option>
                </select>

                <input type="text" class="form-control" placeholder="Mã đơn hàng">
                <button class="btn search-button" type="button">
                  <i class="fa fa-search"></i>
                </button>
              </div>
            </div>
          </div>

        </div>

        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th style="min-width: 100px;">Mã đơn hàng</th>
              <th>Thao tác</th>
              <th>Ngày đặt hàng</th>
              <th>Tình trạng</th>
              <th style="min-width: 100px;">Kiểu thanh toán</th>
              <th style="min-width: 100px;">Số tiền đặt cọc</th>
              <th style="min-width: 100px;">Số tiền còn cần thanh toán</th>
              <th style="min-width: 100px;">Tổng tiền(vnd)</th>
              <th style="min-width: 30px;">Hủy đơn hàng</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let us of user | paginate: { itemsPerPage: 10, currentPage: currentPage }; let i = index">

              <td style=" min-width: 150px;">{{ us?.code}}</td>
              <td class="action-buttons">
                <!-- <a href="#" class="settings" title="Edit" data-toggle="modal" data-target="#editProductModal">
                  <i class="fa-solid fa-pen-to-square"></i>
                </a> -->
                <a href="#" class="info" title="Info" data-toggle="modal" data-target="#productDetailModal"
                  (click)="getOrderDetail(us)">
                  <i class="fa-solid fa-circle-info"></i>
                </a>

                <!-- Dropdown for changing status -->
              </td>
              <td>{{ us?.orderDate | date:'dd/MM/yyyy' }}</td>

              <!-- [disabled]="us?.status.status_id === 6 || us?.status.status_id === 5
              || us?.status.status_id === 1
              || us?.status.status_id === 3"  -->
              <td style="min-width: 200px;" *ngIf="us?.totalAmount === null">
                <div class="select-wrapper">
                  <select [disabled]="us?.status.status_id !== 5 && us?.status.status_id !== 4" class="custom-select" (change)="onStatusChange(us.orderId, $event)">
                    <option *ngFor="let status of status_order" [value]="status.status_id" 
                      [selected]="status.status_id === us?.status.status_id"
                      [hidden]="status.status_id !== 7 && status.status_id !== 8">
                      {{ status.status_name }}
                    </option>
                  </select>
                </div>
              </td>
              <td style="min-width: 200px;" *ngIf="us?.totalAmount !== null">
                <div class="select-wrapper">
                  <select [disabled]="us?.status.status_id !== 5 && us?.status.status_id !== 4" class="custom-select" (change)="onStatusChange(us.orderId, $event)">
                    <option *ngFor="let status of status_order" [value]="status.status_id"
                      [selected]="status.status_id === us?.status.status_id"
                      [disabled]="status.status_id !== 5">
                      {{ status.status_name }}
                    </option>
                  </select>
                </div>
              </td>




              <td style=" min-width: 50px;"
                [ngStyle]="{'color': us?.paymentMethod === 1 ? 'green' : (us?.paymentMethod === 0 ? 'red' : 'black')}">
                {{ us?.paymentMethod === 1 ? 'Chuyển khoản' : (us?.paymentMethod === 0 ? 'Tiền mặt' : '') }}
              </td>

              <td>{{ us?.deposite | number : '1.0-3' }}</td>
              <td>{{ (us?.totalAmount - us?.deposite) | number : '1.0-3'
                }}</td>
              <td>{{ us?.totalAmount | number : '1.0-3' }}</td>
              <td>
                <a href="#" class="delete" title="Delete" data-toggle="modal" data-target="#confirmDeleteModal"
                  (click)="setOrderForCancellation(us?.orderId, us?.specialOrder)"
                  *ngIf="us?.status?.status_id === 7">
                  <i class="fa-solid fa-times"></i>
                </a>
                <!-- <button class="delete-btn" title="Hủy" data-toggle="modal" data-target="#confirmDeleteModal"
                  (click)="setOrderForCancellation(us?.orderId, us?.specialOrder)"
                  *ngIf="us?.status?.status_id !== 7">
                  <i class="fa-solid fa-time"></i> 
                </button> -->
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <pagination-controls style="justify-content: right; display: flex;" (pageChange)="currentPage = $event"
      previousLabel="Trang trước" nextLabel="Trang sau">
    </pagination-controls>
    <div class="clearfix" style="justify-content: right; display: flex;">
      <div class="hint-text">Hiển thị <b>{{ (currentPage - 1) * 10 + 1 }}</b> tới <b>{{ currentPage * 10
          > user.length ? user.length : currentPage * 10 }}</b> trong tổng <b>{{
          user.length }}</b> dữ liệu</div>
    </div>


  </div>
</div>

<!-- Modal for Adding User -->
<div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-center" id="addProductModalLabel">Add New Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="productName">Product Name</label>
            <input type="text" class="form-control" id="productName" placeholder="Enter product name">
          </div>
          <div class="form-group">
            <label for="productDescription">Description</label>
            <textarea class="form-control" id="productDescription" rows="3"
              placeholder="Enter product description"></textarea>
          </div>
          <div class="form-group">
            <label for="productCategory">Category</label>
            <select class="form-control" id="productCategory">
              <option [ngValue]="null" disabled selected>Choose category</option>
              <option *ngFor="let ps of position" [value]="ps.position_id">{{ ps.position_name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="productQuantity">Quantity</label>
            <input type="number" class="form-control" id="productQuantity" placeholder="Enter quantity">
          </div>
          <div class="form-group">
            <label for="productPrice">Price (vnđ)</label>
            <input type="number" class="form-control" id="productPrice" placeholder="Enter price">
          </div>
          <div class="form-group">
            <label for="productImage">Product Image</label>
            <input type="file" class="form-control-file" id="productImage">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal for Editing Product -->
<div class="modal fade" id="editProductModal" tabindex="-1" role="dialog" aria-labelledby="editProductModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProductModalLabel">Edit Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="editProductName">Product Name</label>
            <input type="text" class="form-control" id="editProductName">
          </div>
          <div class="form-group">
            <label for="editProductDescription">Description</label>
            <textarea class="form-control" id="editProductDescription" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="editProductCategory">Category</label>
            <select class="form-control" id="editProductCategory">
              <option [ngValue]="null" disabled selected>Choose category</option>
              <option *ngFor="let ps of position" [value]="ps.position_id">{{ ps.position_name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editProductQuantity">Quantity</label>
            <input type="number" class="form-control" id="editProductQuantity">
          </div>
          <div class="form-group">
            <label for="editProductPrice">Price (vnđ)</label>
            <input type="number" class="form-control" id="editProductPrice">
          </div>
          <div class="form-group">
            <label for="editProductImage">Product Image</label>
            <input type="file" class="form-control-file" id="editProductImage">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal for Delete Product -->
<!-- <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this product?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div> -->
<!-- Modal for Product Detail -->
<div class="modal fade" id="productDetailModal" tabindex="-1" role="dialog" aria-labelledby="productDetailModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailModalLabel">Xem chi tiết đơn hàng</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-2">

          </div>
          <div class="col-md-10">
            <h4 class="mb-4">Tên Sản Phẩm: {{ OrderdetailById.product_name }}</h4>
            <p class="mb-2"><strong>Mã đơn chi tiết:</strong> {{ OrderdetailById.order_detail_id }}</p>
            <p class="mb-2"><strong>Sản phẩm yêu cầu:</strong> {{ OrderdetailById.request_product_name }}</p>
            <p class="mb-2"><strong>Số lượng:</strong> {{ OrderdetailById.quantity }}</p>
            <p class="mb-2"><strong>Giá:</strong> {{ OrderdetailById.price | number:'1.0-3' }} VNĐ </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteModalLabel">Xác nhận muốn hủy đơn hàng</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Bạn có chắc muốn hủy đơn hàng này không ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy </button>
        <button type="button" class="btn btn-primary" (click)="confirmCancel()">Xác nhận</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoadding" class="loading-overlay">
  <div class="spinner"></div>
</div>